L'ordre SQL (simplifié, voir la documentation officielle d'Oracle) de création d'un trigger s'écrit : 

```SQL
CREATE [OR REPLACE] TRIGGER <nom_trigger>
BEFORE | AFTER | INSTEAD OF
INSERT | UPDATE | DELETE 
[OF <liste_colonne> ON <nom_table>]
[FOR EACH ROW]
[WHEN <condition>]
[bloc plsql];
/
```

>[!attention] L'ajout d'un `/` en fin de déclaration est nécessaire pour distinguer les différents ajouts de procédures/triggers.

Avant de coder le corps du trigger, il faut décider des paramètres de ses composantes :

- La synchronisation du trigger
- L’évènement déclenchant
- Le type de trigger

| Composante                 | Description                                                                                                     | Valeurs possibles             |
| -------------------------- | --------------------------------------------------------------------------------------------------------------- | ----------------------------- |
| Synchronisation du trigger | Définit à quel moment le trigger se déclenche pendant l'intéraction                                             | `BEFORE`,`AFTER`,`INSTEAD OF` |
| Evénement déclenchant      | Définit quelle opération de manipulation de données sur la table ou la vue entraîne le déclenchement du trigger | `INSERT`, `UPDATE`, `DELETE`  |
| Type de trigger            | Définit combien de fois le corps du trigger est exécuté                                                         | `STATEMENT`, `ROW`            |
| Corps du trigger           | Définit les actions qui seront exécutées par le trigger                                                         | Bloc PL/SQL                              |

---

### Les composants d'un trigger : La synchronisation

La synchronisation du trigger définit le moment ou le trigger sera déclenché. Elle peut prendre trois valeurs : `BEFORE`, `AFTER` et `INSTEAD OF`.

- Un trigger `BEFORE` exécute le corps du trigger avant l’évènement **LMD** déclenchant, sur la table. Par exemple : Modifier les valeurs des colonnes avant d'effectuer un ordre déclenchant de type `INSERT` ou `UPDATE`.

- Un trigger `AFTER` exécute le corps du trigger après que l’évènement **LMD** se soit produit sur la table, exemple : Exécuter plusieurs actions sur un ordre déclenchant possédant déjà un trigger `BEFORE`.

- Un trigger `INSTEAD OF` exécute le corps du trigger au lieu de l'ordre déclenchant, des exemples de ce trigger seront vue dans le cours consacré à la notion de vues.

---

### Les composants d'un trigger : L'évènement déclenchant

Les évènements déclenchant les triggers peuvent être les ordres LMD : `INSERT`, `UPDATE`, `DELETE`

L'évènement déclenchant peut être composé de plusieurs opérations LMD.

Exemple : 
```sql
CREATE OR REPLACE TRIGGER print_salary_changes
BEFORE DELETE OR INSERT OR UPDATE ON emp_tab
FOR EACH ROW
WHEN new.empno > 0
DECLARE
	salary_diff NUMBER;
BEGIN 
	salary_diff = :new.salary - :old.salary
	dbms_output.put('Old salary : ' || :old.salary);
	dbms_output.put('New salary : ' || :new.salary);
	dbms_output.put('Difference : ' || salary_diff);
END;
/
```

---

### Les composants d'un trigger : Le type de trigger

Le type de trigger représente le nombre de fois que le corps du trigger sera exécuté lorsque l'évènement déclenchant se produit.

Il peut prendre deux valeurs : `STATEMENT` et `ROW`.

- Un trigger `STATEMENT` ne s'exécute qu'une fois pour tout l'évènement déclenchant même si aucune ligne n'est concernée. 
  Il est utile si l'action du trigger ne dépend pas des données des lignes concernées ou des données fournies par l'évènement déclenchant lui-même. Par exemple, un trigger qui exécute une vérification de sécurité complexe sur l'utilisateur courant.

- Un trigger `ROW` est un trigger dont le corps s'exécute une fois pour chaque ligne concernée par l'évènement déclenchant. Si l'évènement déclenchant n'affecte aucune ligne, le corps du trigger n'est pas exécuté. 
  Un trigger `ROW` est utile lorsque sont action dépend des données des lignes affectées ou des données fournies directement par l'évènement déclenchant.

---

### Les composants d'un trigger : Le corps du trigger

Le corps du trigger définit toutes les actions qui seront exécutées lors du déclenchement

Le corps est constitué d'un bloc PL/SQL ou d'un appel à une procédure.

Le bloc PL/SQL peut contenir des ordres SQL et PL/SQL, définir des éléments PL/SQL comme des variables, des curseurs, des exceptions et autres. 

**Cours à voir :**
- [[20. La séquence de déclenchement]]