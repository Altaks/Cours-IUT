
Une table en cours de modifications est une table dans laquelle sont effectuées des modifications grâce à des ordres `LMD` (`UPDATE`, `INSERT` ou `DELETE`) ou une table ayant besoin d'être mise à jour par les effets d'un `DELETE CASCADE`

Une table n'est pas considérée comme en cours de modification lorsque le trigger est de type `STATEMENT`.

La lecture et l'écriture dans les tables en cours de modification sont soumises à certaines règles. Ces restrictions ne s'appliquent que pour les `ROW` triggers ou pour les triggers déclenchés à la suite d'un ordre `ON DELETE CASCADE`

Une table sur laquelle agit un trigger est considérée comme en cours de modification, ainsi que chaque table lui faisant référence en tant que `FOREIGN KEY`. Cette restriction empêche le `ROW` trigger de voir un ensemble de données inconsistant.

On crée un trigger vérifiant que le salaire se trouve dans la bonne fourchette en fonction du type de job lors de l'ajout d'un employé ou de la modification d'un employé existant.

```SQL
CREATE OR REPLACE TRIGGER trigger_verif_salaire
BEFORE INSERT OR UPDATE OF salary, job ON emp
FOR EACH ROW
WHEN (new.job <> 'PRESIDENT')
DECLARE
	v_minsalary emp.sal%TYPE;
	v_maxsalary emp.sal%TYPE;
BEGIN
	SELECT MIN(salary), MAX(salary) INTO v_minsalary, v_maxsalary
	FROM emp 
	WHERE job = :new.job;
	
	IF (:new.salary < v_minsalary OR :new.salary > v_maxsalary) THEN
		RAISE_APPLICATION_ERROR(-20505, 'Problème valeur')
	ENDIF;
END;
/
```

```
SQLPLUS> UPDATE emp SET salary=1500 WHERE ename='SMITH';
ERROR at line 2:
ORA-04091 : table emp is mutating, trigger/function may not see it
ORA-06512 : at "TRIGGER_VERIF_SALAIRE", line 5
ORA-04088 : error during execution of trigger "TRIGGER_VERIF_SALAIRE"
``` 

Lorsqu'on essaie de restreindre le salaire à des valeurs comprises entre une fourchette constituée des valeurs minimales et maximales existantes, il se produit une erreur d'exécution.

La table `emp` est considérée comme en cours de modification du fait de l'utilisation des valeurs qu'elle contient donc il est impossible de lire et d'écrire dans celle-ci pour des raisons d'intégrité des données utilisées pour le trigger.

**Cours à voir :**
- [[27. Introduction à l'Object Relational Mapping]]