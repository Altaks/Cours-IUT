>[!important] Qu'est ce qu'un utilisateur ?
>Un utilisateur c'est un **nom**, associé à un **mot de passe** (explicite ou implicite), qui eux mêmes sont liés à un ensemble de privilgèes/droits

Il existe alors trois ordres SQL associés à la notion d'utilisateur : 

- Création d'utilisateur `CREATE USER ...`
- Modificiation d'utilisateur `ALTER USER ...`
- Suppression d'utilisateur `DROP USER ...`

---

### Création d'un utilisateur 

Voici la syntaxe de création d'un utilisateur : 

```SQL
CREATE USER nom_utilisateur
			IDENTIFIED { BY mot_de_passe | EXTERNALLY }
			[DEFAULT TABLESPACE nom_tablespace]
			[TEMPORARY TABLESPACE nom_tablespace]
			[QUOTA { valeur [K | M] | UNLIMITED } ON nom_tablespace [, ...] ]
			[PROFILE nom_profil]
			[PASSWORD EXPIRE]
			[ACCOUNT {LOCK | UNLOCK}]; 
```

Voici la description des paramètres : 

- `nom_utilisateur` : le nom d'utilisateur doit respecter les règles de nommage SQL (dépend aussi du SGBD). *Si ce n'est pas le cas, il faut mettre le nom entre guillemets*
  
- `IDENFITIED` : Cette clause indique si l'utilisateur est identifié par le système d'exploitation (`EXTERNALLY`) ou par le SGBD (`BY mot_de_passe`). Dans le cas d'une identification par SGBD, le mot de passe initial de l'utilisateur est spécifié. 
  Ce dernier doit respecter les règles de nommage, sauf si, comme dans le cas d'Oracle, la fonctionnalié de contrôle de la complexité des mots de passe est mises en œuvre.

- `DEFAULT TABLESPACE` : Cette clause indique dans quel espace de tables les segments de l'utilisateur sont crées par défaut (on reviendra sur la notion d'espaces de tables). 

- `QUOTA` : Cette clause indique dans quel(s) tablespace(s) l'utilisateur peut créer des objets, et jusqu'à quelle limite. La notion de `QUOTA` permet de limiter l'espace qu'un utilisateur peut employer dans un tablespace avec les segments qu'il crée. 
  
  Dans la pratique, il ne faut donner des quotas qu'aux utilisateurs qui en ont besoin (ex: les développeurs) et uniquement sur les tablespaces strictement nécessaires et suffisants.

- `PROFILE` : Cette clause indique le profil attribué à cet utilisateur
  
- `PASSWORD EXPIRE` : Cette clause permet de forcer une modification du mot de passe lors de la premère connexion (le mot de passe de l'utilisateur est expiré). Si le compte est crée avec l'option `PASSWORD EXPIRE`, l'utilisateur, lors de sa première connexion, sera invité à changer son mot de passe.
  
  Cette clause est sans utilité si l'utilisateur est identifié par le système d'exploitation.

- `ACCOUNT LOCK` : Le compte est verrouillé et la connexion est interdite. 
  `ACCOUNT UNLOCK` : Le compte n'est plus verrouillé et la connexion est autorisée (valeur par défaut)

---

### Espace de tables par défaut d'un utilisateur

La clause `DEFAULT TABLESPACE` indique dans quel espace de table les segments de l'utilisateur sont créés par défaut.

Un tablespace est une unité logique de stockage composée d'un ou plusieurs fichiers logiques (fichiers de données). Un tablespace est composé en segments.

Si cette clause est omise, c'est le tablespace `SYSTEM` qui devient le tablespace par défaut de l'utilisateur. Seuls les utilisateurs `DBA` (database admin) possèdent un quota sur le tablespace `SYSTEM`.

Une base de données possède toujours au minimum deux espaces de tables nommés `SYSTEM` et `SYSAUX` : 

- Espace de table `SYSTEM` : Contient le [[3.2 Que contient le dictionnaire de données|dictionnaire des données]]
- Espace de table `SYSAUX` : Contient les données de certains comopsants du SBGD (ici Oracle)

Normalement, les tablespaces SYSTEM et SYSTAUX ne doivent pas contenir de données utilisateurs.

---

### Modifier un utilisateur

Afin de modifier un utilisateur, vous devez simplement utiliser l'ordre 
`ALTER USER <user>` suivi des mêmes clauses que lors de la création

---

### Suppression d'un utilisateur

La syntaxe SQL est la suivante : 

```SQL
DROP USER nom_utilisateur [ CASCADE ];
```

- `nom_utilisateur` correspond au nom de l'utilisateur à supprimer
- `CASCADE` : supprime tous les objets dans le schéma de l'utilisateur avant de supprimer l'utilisateur en lui même. Cette option doit être spécifiée pour supprimer un utilisateur dont le schéma contient des objets
- L'option `CASCADE` doit être utilisée avec prudence
- L'utilisateur connecté ne peut être supprimé
- On doit avoir le privilège `DROP USER` pour supprimer un utilisateur

---

### Espace de tables permanent d'un utilisateur

Pour simplifier la gestion des utilisateurs, il est possible de définir un tablespace permanent par défaut pour l'utilisateur.

Cet espace de table est affecté par défaut aux utilisateurs lors de leur création (si la clause `DEFAULT TABLESPACE` est omise).

L'espace de tables permanent par défaut peut être défini lors de la création de la base de données, grâce à la clause `DEFAULT TABLESPACE` de l'ordre `CREATE DATABASE` : https://docs.oracle.com/database/121/SQLRF/statements_5005.htm#i2142339

Cette technique n'empêche pas d'utiliser d'autres tablespaces permanents affectés spécifiquement pour des besoins particuliers 

Se pose alors la question de la création des espaces de tables 

---

### Créer un espace de table

Voici la syntaxe SQL de l'ordre de création d'un espace de table 

```SQL
CREATE TABLESPACE nom_tablespace
	   DATAFILE file_spec [autoextend_clause]
	   [MINIMUM EXTENT integer [K | M]]
	   [DEFAULT STORAGE storage_clause]
	   [PERMANENT | TEMPORARY]
	   [ONLINE | OFFLINE];
```

Avec : 

```sql
storage_clause := {
	[INITIAL integer [K | M]]
	[NEXT integer [K | M]]
	[MINEXTENTS integer]
	[MAXEXTENTS {integer | UNLIMITED}]
	[PCTINCREASE integer]
}
```

---
## Exemples

### Exemple de création d'un espace de table

- Nom de l'espace de tables : `USERS`
- Nom du fichier de données : `user01.dbf`
- Taille du fichier de données : 10Mo
- Emplacement : `/opt/oracle/oradata/`

```SQL
CREATE TABLESPACE USERS 
	   DATAFILE 'opt/oracle/oradata/users01.dbf' SIZE 10M;
```

### Exemple de création d'un utilisateur

- Nom de l'utilisateur : `user1`
- Mot de passe : `user1pwd`
- Espace de table par défaut : `USERS`, Quota : 5Mo
- Espace de table temporaire : `TEMP`

```sql
CREATE USER user1
			IDENTIFIED BY user1pwd
			DEFAULT TABLESPACE users
			QUOTA 5M ON users
			TEMPORARY TABLESPACE temp;
```

- Par défaut, un user n'a aucun droit d'accès aux espaces de tables de la base de données
- Assigner des quotas à un utilisateur empêche une consommation démesurée d'espace.

### Exemples de modifications d'un utilisateur

Modification du mot de passe d'un utilisateur : 

```sql
ALTER USER test IDENTIFIED BY tempo PASSWORD EXPIRE;
```

Modification de l'espace de table par défaut et attribution de quotas :

```sql
ALTER USER test DEFAULT TABLESPACE data QUOTA 10M ON daat QUOTA UNLIMITED on temp;
```

Verrouillage d'un compte :

```sql
ALTER USER test ACCOUNT LOCK;
```

Déverrouillage d'un compte :

```SQL
ALTER USER test ACCOUNT UNLOCK;
```

**Cours à voir :**
- [[5.5 Mécanisme de privilèges]]