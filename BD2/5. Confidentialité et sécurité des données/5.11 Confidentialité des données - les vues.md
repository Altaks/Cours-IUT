Nous avons évoqué la possibilité d'utiliser des vues pour assurer la confidentialité des données. Nous allons voir comment il est possible d'interdire l'accès à certaines lignes (contenus) et/ou à certaines colonnes (contenants) d'une table.
Nous verrons aussi que, grâce aux vues, il est possible d'émettre des restrictions d'accès en fonction du contexte.

Illustrons ceci par quelques exemples pour lesquels nous donnons le type d'accès à définir et la manière de le faire dans le langage SQL. Les exemples seront basés sur la table 

```
PERSONNEL(NUMERO, NOM, PRENOM, ADRESSE, NUM_SERVICE, SALAIRE, PERFORMANCE)
```

Nous supposons qu'aucun des utilisateurs cités dans les exemples si dessous ne possède les privilèges sur la table `PERSONNEL` et que cette dernière a été créée dans le schéma `RH`.

---

### Contrôle dépendant du contexte

Chaque utilisateur peut visualiser un seul tuple de la relation, celui qui le concerne.

On définit d'abord une vue `information_me_concernant` dépendant du contexte en utilisant la variable d'environnement `USER`. 
Cette variable d'environnement contient le nom de l'utilisateur qui démarre la session SQL ou qui a lancé le programme d'applications :

```SQL
CREATE VIEW information_me_concernant
            AS SELECT numero, nom, prenom, adresse, num_service, salaire, performance
            FROM personnel
            WHERE upper(nom) = upper(USER);
```

Dans un second temps, on donne les privilèges de lecture sur la vue à chaque utilisateur :

```SQL
GRANT SELECT ON information_me_concernant TO PUBLIC;
```

```SQL
CREATE PUBLIC SYNONYM information_me_concernant FOR RH.information_me_concernant;
```

---

### Contrôle dépendant du contexte et du contenant

Chaque utilisateur peut lire un seul n-uplet de la relation : celui qui le concerne. Il peut aussi modifier son adresse : 

```SQL
CREATE VIEW information_me_concernant
            AS SELECT numero, nom, prenom, adresse, num_service, salaire, performance
            FROM personnel
            WHERE upper(nom) = upper(USER);
```

```SQL
GRANT SELECT, UPDATE(adresse) ON information_me_concernant TO PUBLIC;
```

```SQL
CREATE PUBLIC SYNONYM information_me_concernant FOR RH.information_me_concernant;
```

---

### Contrôle dépendant du contenant

L'utilisateur `user_personnel1` peut lire le contenu des colonnes `NUMERO`, `NOM`, `PRENOM`, `ADRESSE` et `NUM_SERVICE` et modifier le contenu des colonnes `ADRESSE` et `NUM_SERVICE`.

```SQL
CREATE VIEW liste_personnels AS
            SELECT numero, nom, prenom, adresse, num_service
            FROM personnel;
```

```SQL
CREATE ROLE role_personnel1;
```

```SQL
GRANT SELECT, UPDATE(adresse, num_service) ON liste_personnels TO role_personnel1;
```

```SQL
GRANT ROLE role_personnel1 TO user_personnel1;
```

**Cours à voir :**
- [[5.12 Métabase]]