### Les [images](https://hub.docker.com/search?q=&type=image) 

Les images sont un ensemble de couches logicielles composées pour faire fonctionner un service :
- Elles n'ont pas d'état (elles ne changent jamais sauf en cas de changement de version)
- Elles sont identifiées par un **ID Docker**
- Elles sont identifiées par un couple **`repository/tag`**, quelques exemples :
	- `ubuntu/nginx`
	- `ubuntu/squid`
	- `ubuntu/apache2`
	- `mysql/mysql-server`
	- `mysql/mysql-cluster`
	- `mysql/mysql-operator`
	- `google/cadvisor`
	- ...
- Elles servent de base aux containers

---

### Les conteneurs

Les containers sont des instances/runtimes d'**images** docker : 
- Ils dépendent d'**images**
- Ils disposent d'un **environnement isolé** et ont des **instructions d'exécution** (quels programmes démarrent quand le container démarre)
- On un **statut** : `CREATED, RUNNING, RESTARTING, PAUSED, EXITED, DEAD`
- Sont identifiés par un **nom**
- Sont identifiés par un **ID Docker**

---

### Le registre Docker

Un des grands avantages de Docker est la facilité avec laquelle nous pouvons utiliser des images prêtes à l'emploi. 

Il existe un site spécialisé : [Le Docker Hub](https://hub.docker.com) ou l'on peut explorer les images a disposition et publier les nôtres.

---

### Exemple : L'image [Hello-World](https://hub.docker.com/_/hello-world)

Une des meilleures méthodes pour être certain que notre installation Docker est fonctionnelle est de lancer un container, et Docker y a pensé en créant une image de "test"

Une fois Docker installé, vous pouvez exécuter la commande suivante : 

```bash
docker run hello-world
```

Ce qui vous renverra une sortie sur le terminal similaire à : 

```
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
719385e32844: Pull complete 
Digest: sha256:4f53e2564790c8e7856ec08e384732aa38dc43c52f02952483e3f003afbf23db
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
```

**Si on décompose l'output ci-dessus on observe que :**

- Le Docker Client envoie la commande au Docker Daemon
- Il remarque qu'il n'a pas l'image `hello-world` localement (sur l'hôte) et va **récupérer l'image** sur le registre (Docker Hub)
- Il **vérifie** l'intégrité de l'image récupérée via le **hash SHA256**.
- Le Docker Daemon **créé un nouveau container**, celui-ci va exécuter un script qui va envoyer un message sur la console
- Le message est streamé vers le Docker Client et l'**affiche dans la console** (la sortie standard)
- Le script se termine, le container s'arrête tout seul

---

### Exemple : Exécuter un environnement Linux

Pour lancer un container qui contiendra un environnement Linux, on peut exécuter la commande suivante : 

```bash
docker run -it -p 80:80 --name ubuntu ubuntu
```

Analysons la commande :

| Arguments       | Description                                                  | Syntaxe              |
| --------------- | ------------------------------------------------------------ | --------------------------------- |
| `docker run`    | On va lancer un container d'après une image                  |                                   |
| `-it`           | On le lance en mode intéractif                               |                                   |
| `-p 80:80`      | On va connecter le port 80 de l'hôte au port 80 du container | `-p <host-side>:<container-side>` |
| `--name ubuntu` | On nomme le container avec un nom personnalisé : `ubuntu`    | `--name <name>`                   |
| `ubuntu`        | On choisit l'image `ubuntu`                                  | `docker run [options] <image>`    |

On obtient dans la console ceci : 

```
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
445a6a12be2b: Pull complete 
Digest: sha256:aabed3296a3d45cede1dc866a24476c4d7e093aa806263c27ddaadbdce3c1054
Status: Downloaded newer image for ubuntu:latest
root@c61f97dcb064:/# 
```

On remarque qu'on arrive sur une console avec l'utilisateur `root` sur le container. Vous venez de lancer un Ubuntu dans un container !

Une fois le conteneur lancé, on peut se servir des outils standards d'Ubuntu : 

```
root@c61f97dcb064:/# ls /
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
```

On peut alors par exemple installer Python3 dans le container : 

```
apt update && apt install python3 -y
```

Puis lancer la console Python3 : 

```
root@c61f97dcb064:/# python3
Python 3.10.12 (main, Jun 11 2023, 05:26:28) [GCC 11.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> 
```

*On peut quitter le mode interactif du container avec le raccourci `Ctrl-P + Ctrl-Q` sans pour autant éteindre le container*

**Depuis l'hôte**, on peut aussi voir **quels processus** sont en cours **dans le conteneur** : 

```bash
docker top ubuntu
```

*Pour se reconnecter à la console du container, vous pouvez utiliser la commande suivante*

```bash
docker attach ubuntu
```

On se retrouve alors dans le mode interactif à nouveau

```
root@c61f97dcb064:/# 
```

>[!example] Si l'on souhaite installer un serveur Web
>
Si l'on souhaite installer un serveur web : 
> 
> ```bash
apt install nginx
service nginx start
> ```
> 
> Depuis l'hôte, le serveur est alors accessible depuis le port 80.
> Cette installation (et cet exemple) est minimale, mais vous pourrez trouver sur Docker Hub des images pour tous les services dont vous pourriez avoir besoin dans le futur.

